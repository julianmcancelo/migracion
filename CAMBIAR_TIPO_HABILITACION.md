# ğŸ“‹ Cambiar Tipo de HabilitaciÃ³n

## ğŸ¯ DescripciÃ³n

Sistema para visualizar y modificar el **Tipo de HabilitaciÃ³n** con registro automÃ¡tico en el historial de novedades.

---

## ğŸ¨ Tipos de HabilitaciÃ³n Disponibles

| Tipo | DescripciÃ³n | CuÃ¡ndo Usarlo |
|------|-------------|---------------|
| **Alta** | Primera vez | HabilitaciÃ³n nueva sin antecedentes |
| **RenovaciÃ³n** | RenovaciÃ³n periÃ³dica | Vencimiento y renovaciÃ³n normal |
| **Cambio de Material** | Cambio de vehÃ­culo | Cuando se cambia el material rodante |
| **Cambio de Titularidad** | Cambio de titular | Transferencia a nuevo responsable |
| **AmpliaciÃ³n** | AmpliaciÃ³n de servicios | Agregar unidades o rutas |
| **ModificaciÃ³n** | Cambio de datos | ActualizaciÃ³n de informaciÃ³n |
| **Baja** | Cese de actividad | FinalizaciÃ³n de la habilitaciÃ³n |

---

## ğŸ“ UbicaciÃ³n

### **En el Modal de Detalle de HabilitaciÃ³n:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HabilitaciÃ³n #100                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Datos de la HabilitaciÃ³n              â”‚
â”‚                                        â”‚
â”‚ Estado: HABILITADO                     â”‚
â”‚ Tipo Transporte: Escolar               â”‚
â”‚                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Tipo de HabilitaciÃ³n [Cambiar]   â”‚  â”‚
â”‚ â”‚ RenovaciÃ³n               â† AQUÃ   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚ Vigencia Inicio: 01/01/2024           â”‚
â”‚ Vigencia Fin: 31/12/2024              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ CÃ³mo Cambiar el Tipo

### **Paso 1: Abrir Modal de Detalle**
```
Habilitaciones â†’ Click en habilitaciÃ³n
```

### **Paso 2: Click en "Cambiar"**
```
En la secciÃ³n "Tipo de HabilitaciÃ³n"
```

### **Paso 3: Seleccionar Nuevo Tipo**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Cambiar Tipo de HabilitaciÃ³n       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tipo Actual: RenovaciÃ³n                â”‚
â”‚                                        â”‚
â”‚ Nuevo Tipo: [Cambio de Material â–¼]    â”‚
â”‚                                        â”‚
â”‚ Observaciones (opcional):              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Cambio solicitado por titular...   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚ â„¹ï¸ Se registrarÃ¡ en el historial      â”‚
â”‚                                        â”‚
â”‚ [Cancelar] [Cambiar Tipo]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Paso 4: Confirmar**
```
Se actualiza el tipo
Se registra en historial de novedades
```

---

## ğŸ“Š Registro en Novedades

Cada cambio de tipo se registra automÃ¡ticamente:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ HISTORIAL DE NOVEDADES              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ â”€â”                                  â”‚
â”‚     â”‚  CAMBIO_TIPO                     â”‚
â”‚     â”‚  Cambio de tipo:                 â”‚
â”‚     â”‚  RenovaciÃ³n â†’ Cambio de Material â”‚
â”‚     â”‚  ğŸ“ Cambio solicitado por...     â”‚
â”‚     â”‚  ğŸ“… 23/10/24 14:30 ğŸ‘¤ Admin      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ VisualizaciÃ³n Destacada

El tipo se muestra en una **caja destacada azul** con botÃ³n de ediciÃ³n:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tipo de HabilitaciÃ³n      [âœï¸ Cambiar] â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â”‚
â”‚ Cambio de Material                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ImplementaciÃ³n TÃ©cnica

### **Endpoint API:**

```typescript
POST /api/habilitaciones/{id}/cambiar-tipo

Body:
{
  "tipo_nuevo": "Cambio de Material",
  "observaciones": "Cambio solicitado por el titular..."
}

Response:
{
  "success": true,
  "message": "Tipo de habilitaciÃ³n actualizado exitosamente",
  "data": {
    "tipo_anterior": "RenovaciÃ³n",
    "tipo_nuevo": "Cambio de Material"
  }
}
```

### **Componentes:**

**Modal de Cambio:**
```tsx
// app/(panel)/habilitaciones/_components/modal-cambiar-tipo.tsx
<ModalCambiarTipo
  open={modalOpen}
  onOpenChange={setModalOpen}
  habilitacion={habilitacion}
  onCambioExitoso={() => recargar()}
/>
```

**En Modal de Detalle:**
```tsx
// SecciÃ³n destacada con botÃ³n
<div className="border-2 border-blue-200 bg-blue-50 p-4">
  <Button onClick={() => setModalOpen(true)}>
    Cambiar
  </Button>
  <p>{habilitacion.tipo || 'Sin especificar'}</p>
</div>
```

---

## ğŸ” Permisos

- âœ… **Admin** - Puede cambiar tipo
- âœ… **Inspector** - Puede cambiar tipo
- âŒ **Demo** - No puede cambiar tipo
- âŒ **Lector** - No puede cambiar tipo

---

## ğŸ“ Novedades Registradas

Cada cambio genera una novedad con:

- **Tipo:** `CAMBIO_TIPO`
- **Entidad:** `HABILITACION`
- **DescripciÃ³n:** "Cambio de tipo: X â†’ Y"
- **Datos anteriores:** `{ tipo: "X" }`
- **Datos nuevos:** `{ tipo: "Y" }`
- **Usuario:** Nombre del usuario que hizo el cambio
- **Observaciones:** Notas opcionales

---

## ğŸ¯ Casos de Uso Reales

### **1. Cambio de Material Rodante**
```
Alta â†’ Cambio de Material
"El titular cambiÃ³ su vehÃ­culo anterior por uno nuevo"
```

### **2. RenovaciÃ³n Anual**
```
Alta â†’ RenovaciÃ³n
"Primera renovaciÃ³n anual de la habilitaciÃ³n"
```

### **3. Cambio de Titularidad**
```
RenovaciÃ³n â†’ Cambio de Titularidad
"El vehÃ­culo fue vendido a un nuevo propietario"
```

### **4. AmpliaciÃ³n de Flota**
```
Alta â†’ AmpliaciÃ³n
"Se agregÃ³ una nueva unidad a la flota existente"
```

---

## âœ… Beneficios

- ğŸ“‹ **Claridad** - Se sabe exactamente quÃ© tipo de trÃ¡mite es
- ğŸ” **AuditorÃ­a** - Cada cambio queda registrado
- ğŸ“Š **EstadÃ­sticas** - Permite analizar tipos de trÃ¡mites
- ğŸ¯ **OrganizaciÃ³n** - Facilita la gestiÃ³n administrativa
- ğŸ“ **Trazabilidad** - Historial completo de cambios

---

## ğŸš€ PrÃ³ximas Mejoras

- [ ] Reglas automÃ¡ticas (ej: si cambia vehÃ­culo â†’ tipo "Cambio de Material")
- [ ] Alertas para tipos especÃ­ficos
- [ ] Reportes por tipo de trÃ¡mite
- [ ] Validaciones segÃºn el tipo
- [ ] Workflows especÃ­ficos por tipo

---

**Sistema de Cambio de Tipo: FUNCIONANDO** âœ…
