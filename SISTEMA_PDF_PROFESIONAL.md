# üìÑ Sistema de PDF Profesional

## ‚úÖ Implementado

He creado un sistema de generaci√≥n de PDFs basado en la est√©tica del sistema antiguo pero modernizado.

---

## üé® Dise√±o del PDF

### **Estructura Visual:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ  üìã Certificado de Habilitaci√≥n        ‚îÇ
‚îÇ  Municipalidad de Lan√∫s                ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  MARCA DE AGUA: "HABILITADO"           ‚îÇ
‚îÇ  (Solo si estado = HABILITADO)         ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚úì Datos Generales                     ‚îÇ
‚îÇ    N¬∞ Licencia: 123   Expediente: ABC  ‚îÇ
‚îÇ    Resoluci√≥n: 456    A√±o: 2025        ‚îÇ
‚îÇ    Vigencia: 01/01 - 31/12/2025        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ      ESTADO: HABILITADO          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üë• Personas Autorizadas               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ Rol ‚îÇ Nombre       ‚îÇ DNI      ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ ... ‚îÇ ...          ‚îÇ ...      ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üöó Veh√≠culos Habilitados              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ Dominio‚îÇ Marca  ‚îÇ Modelo ‚îÇ A√±o‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ ...    ‚îÇ ...    ‚îÇ ...    ‚îÇ... ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üè¢ Establecimientos                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Tipo ‚îÇ Nombre ‚îÇ Domicilio‚îÇLocal ‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ ...  ‚îÇ ...    ‚îÇ ...      ‚îÇ ...  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  üìù Observaciones                      ‚îÇ
‚îÇ  ...                                   ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  P√°gina 1 de 1                         ‚îÇ
‚îÇ  Generado el 26/10/2025 18:30          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Caracter√≠sticas

‚úÖ **Marca de agua** ‚Üí "HABILITADO" en diagonal (solo si aplica)  
‚úÖ **Colores por estado** ‚Üí Verde, amarillo, rojo  
‚úÖ **Tablas profesionales** ‚Üí Con jsPDF-AutoTable  
‚úÖ **Header/Footer** ‚Üí Informaci√≥n clara  
‚úÖ **Multip√°gina** ‚Üí Se adapta autom√°ticamente  
‚úÖ **Datos completos** ‚Üí Personas, veh√≠culos, establecimientos  

---

## üì¶ Instalaci√≥n

### **1. Instalar dependencias:**

```bash
npm install jspdf jspdf-autotable
npm install --save-dev @types/jspdf-autotable
```

### **2. Verificar imports en el c√≥digo:**

El archivo ya est√° creado en:
```
app/api/habilitaciones/[id]/descargar-pdf/route.ts
```

---

## üöÄ Uso

### **Desde el Frontend:**

```typescript
// En el componente de habilitaciones
const handleDescargarPDF = async (habilitacionId: number) => {
  try {
    const response = await fetch(
      `/api/habilitaciones/${habilitacionId}/descargar-pdf`
    )
    
    if (!response.ok) throw new Error('Error al generar PDF')
    
    const blob = await response.blob()
    const url = window.URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `Habilitacion-${habilitacionId}.pdf`
    a.click()
    window.URL.revokeObjectURL(url)
  } catch (error) {
    console.error('Error:', error)
    alert('Error al descargar PDF')
  }
}
```

### **Ya implementado en el men√∫:**

El bot√≥n "Descargar PDF" en el men√∫ de acciones ya est√° conectado.

---

## üé® Colores y Est√©tica

### **Paleta de Colores:**

```typescript
const colors = {
  primary: [41, 128, 185],      // Azul profesional
  text: [0, 0, 0],               // Negro texto
  gray: [150, 150, 150],         // Gris subt√≠tulos
  border: [200, 200, 200],       // Gris bordes
  success: [39, 174, 96],        // Verde HABILITADO
  warning: [241, 196, 15],       // Amarillo PENDIENTE
  danger: [231, 76, 60],         // Rojo RECHAZADO
}
```

### **Estados:**

| Estado      | Color   | Texto        |
|-------------|---------|--------------|
| HABILITADO  | Verde   | + Marca agua |
| PENDIENTE   | Amarillo| -            |
| VENCIDO     | Rojo    | -            |
| RECHAZADO   | Rojo    | -            |

---

## üìã Estructura del C√≥digo

### **1. Obtener Datos:**
```typescript
const habilitacion = await prisma.habilitaciones_generales.findUnique({
  where: { id },
  include: {
    habilitaciones_personas: { include: { persona: true } },
    habilitaciones_vehiculos: { include: { vehiculo: true } },
    habilitaciones_establecimientos: { 
      include: { establecimiento: true, remiseria: true } 
    },
  },
})
```

### **2. Generar PDF:**
```typescript
const doc = new jsPDF({ orientation: 'portrait', format: 'a4' })

// Header
doc.text('Certificado de Habilitaci√≥n', 15, 20)

// Marca de agua (condicional)
if (estado === 'HABILITADO') {
  doc.setFontSize(110)
  doc.setTextColor(230, 230, 230)
  doc.text('HABILITADO', 105, 150, { align: 'center', angle: 45 })
}

// Tablas con autoTable
doc.autoTable({
  head: [['Rol', 'Nombre', 'DNI']],
  body: personasData,
  theme: 'grid',
})

// Retornar como Buffer
const pdfBuffer = Buffer.from(doc.output('arraybuffer'))
return new NextResponse(pdfBuffer, {
  headers: {
    'Content-Type': 'application/pdf',
    'Content-Disposition': 'inline; filename="..."',
  },
})
```

---

## üîß Personalizaci√≥n

### **Cambiar colores:**

```typescript
// En la funci√≥n generarPDF()
const colors = {
  primary: [TU_R, TU_G, TU_B],
  // ... m√°s colores
}
```

### **Agregar secciones:**

```typescript
// Despu√©s de las tablas existentes
doc.setFontSize(12)
doc.text('Nueva Secci√≥n', 15, yPos)
yPos += 8

// Tu contenido aqu√≠
```

### **Modificar header/footer:**

```typescript
// En el loop de p√°ginas
for (let i = 1; i <= pageCount; i++) {
  doc.setPage(i)
  // Tu header/footer personalizado
}
```

---

## üì± Ejemplo de Integraci√≥n

### **Bot√≥n en la interfaz:**

```tsx
<DropdownMenuItem
  onClick={() => handleDescargarPDF(hab.id)}
  className="cursor-pointer"
>
  <Download className="mr-2 h-4 w-4" />
  Descargar PDF
</DropdownMenuItem>
```

Ya est√° implementado en:
```
app/(panel)/habilitaciones/_components/habilitaciones-table.tsx
```

---

## üéâ Ventajas

‚úÖ **Profesional** ‚Üí Dise√±o limpio basado en el sistema antiguo  
‚úÖ **Completo** ‚Üí Incluye todos los datos relevantes  
‚úÖ **Responsive** ‚Üí Se adapta a diferentes cantidades de datos  
‚úÖ **Multip√°gina** ‚Üí Maneja documentos largos  
‚úÖ **Moderno** ‚Üí Usa jsPDF (librer√≠a actualizada)  
‚úÖ **Tipado** ‚Üí TypeScript con tipos completos  
‚úÖ **Server-side** ‚Üí Generado en el servidor (m√°s seguro)  

---

## üìù Pr√≥ximas Mejoras (Opcional)

### **1. Agregar logo:**
```typescript
// En el header
const logoUrl = '/logo-municipalidad.png'
doc.addImage(logoUrl, 'PNG', 15, 12, 30, 15)
```

### **2. C√≥digos QR:**
```typescript
import QRCode from 'qrcode'

const qrDataUrl = await QRCode.toDataURL(
  `https://tudominio.com/credencial/${habilitacion.id}`
)
doc.addImage(qrDataUrl, 'PNG', 170, 15, 25, 25)
```

### **3. Firmas digitales:**
```typescript
// Si tienes im√°genes de firmas guardadas
if (habilitacion.firma_url) {
  doc.addImage(habilitacion.firma_url, 'PNG', 15, yPos, 50, 20)
}
```

---

## üöÄ Estado Actual

**‚úÖ Implementado:**
- API endpoint completo
- Generaci√≥n de PDF profesional
- Estructura basada en sistema antiguo
- Integraci√≥n con men√∫ de habilitaciones
- Documentaci√≥n completa

**‚è≥ Pendiente:**
- Instalar dependencias (`npm install jspdf jspdf-autotable`)
- Agregar logo (opcional)
- Personalizar colores institucionales (opcional)

**¬°El sistema est√° listo para usar!** üéØ
