# ğŸ“‹ Certificado de VerificaciÃ³n Vehicular - Transporte Escolar

## âœ… Implementado

He creado un sistema completo para generar **Certificados de VerificaciÃ³n Vehicular** especÃ­ficos para transporte escolar, con diseÃ±o profesional y todos los Ã­tems requeridos en una sola pÃ¡gina.

---

## ğŸ¨ DiseÃ±o del Certificado - OPTIMIZADO

### **Estructura Visual (1 PÃ¡gina A4 - Alta Calidad):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚ â† Header Bordo Compacto
â”‚ CERTIFICADO DE VERIFICACIÃ“N VEHICULAR       â”‚
â”‚ Subsec. de Ordenamiento Urbano - Dir. Gral.â”‚
â”‚                          26/10/2025 - 19:30 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Expte NÂ°: XXX      Licencia NÂ°: XXX         â”‚
â”‚ Tipo: HABILITACIÃ“N Transporte: Escolar      â”‚
â”‚                                             â”‚
â”‚ TITULAR                                      â”‚
â”‚ Nombre: JUAN GARCÃA    DNI: 12345678        â”‚
â”‚ Domicilio: Calle 123, LanÃºs                 â”‚
â”‚                                             â”‚
â”‚ VEHÃCULO            CONDUCTOR               â”‚
â”‚ Dominio: ABC123     Nombre: MARÃA LÃ“PEZ     â”‚
â”‚ Marca: Ford Transit DNI: 87654321           â”‚
â”‚ Insc. Inicial: 01/01/2020                   â”‚
â”‚                                             â”‚
â”‚ DETALLES Y OBSERVACIONES DEL VEHÃCULO       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚DescripciÃ³n â”‚Bâ”‚Râ”‚Mâ”‚Observaciones         â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚Pta. acc... â”‚âœ“â”‚ â”‚ â”‚                      â”‚â”‚
â”‚ â”‚Pta. acc... â”‚âœ“â”‚ â”‚ â”‚                      â”‚â”‚
â”‚ â”‚Salida Emer.â”‚ â”‚âœ“â”‚ â”‚Revisar               â”‚â”‚
â”‚ â”‚... (13 items - tabla compacta)           â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”´â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                             â”‚
â”‚ ________________      ___________________   â”‚
â”‚ Firma Interesado      Firma Verificador    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Mejoras Implementadas:**

âœ… **Layout ultra-compacto** â†’ Todo garantizado en 1 pÃ¡gina  
âœ… **Header reducido** â†’ De 30mm a 25mm  
âœ… **MÃ¡rgenes optimizados** â†’ De 15mm a 12mm  
âœ… **Fuentes escaladas** â†’ TamaÃ±os reducidos pero legibles  
âœ… **Tabla optimizada** â†’ Columnas B/R/M mÃ¡s estrechas (10mm)  
âœ… **Conductor integrado** â†’ En la misma secciÃ³n que vehÃ­culo  
âœ… **Espaciado inteligente** â†’ Menos padding, mismo contenido  
âœ… **CompresiÃ³n PDF** â†’ Archivo mÃ¡s liviano

---

## ğŸ“ Items de VerificaciÃ³n (13 Obligatorios)

1. Pta. accionada cond. para desc./ asc. (Puerta derecha)
2. Pta. accionada cond. para desc./ asc. (Puerta izquierda)
3. Salida de Emer. indep. de laplataf. asc. / desc. (En Caso de Combi - L. Der. y Trasero)
4. Vent. Vidrio Temp. / inastillable (Apertura 10 cm)
5. Pisos rec. con mat. Antideslizantes
6. Dimens. de Banquetas ( desde el piso 0.40 mts - ancho min 0.45mts Prof. medida horiz. 0.40 mts)
7. Asientos: Fijos, Acolchados, Estructu. metalicas, revestimiento (Caucho o similar )
8. Puerta Izquierda de la Carroceria
9. Cinturones de Seguridad en todos los asientos
10. Cabezales o apoya Cabeza en todos los asientos
11. Espacios Libres
12. Pintura ( Carroceria baja y capot naranja NÂº 1054 IRAM - carroceria altatecho y parantes Color blanco)
13. Leyenda de Escolares o NiÃ±os TamaÃ±o minimo : 0,20 mts

---

## ğŸ¯ Archivos Creados

### **1. `components/habilitaciones/certificado-verificacion-pdf.tsx`**
Componente cliente para generar el PDF:

```typescript
export function generarCertificadoVerificacionPDF(datos: DatosVerificacion): jsPDF
```

**CaracterÃ­sticas:**
- Genera PDF en el **navegador** (no en el servidor)
- Header con fondo bordo (color institucional)
- InformaciÃ³n organizada en 2 columnas
- Tabla con 13 items predefinidos
- Columnas: DescripciÃ³n, Bien, Regular, Mal, Observaciones
- Espacios para firmas
- Todo en 1 pÃ¡gina A4

### **2. `app/api/habilitaciones/[id]/certificado-verificacion/route.ts`**
Endpoint API para obtener datos del certificado:

```typescript
GET /api/habilitaciones/[id]/certificado-verificacion
```

**Retorna:**
```json
{
  "success": true,
  "data": {
    "expediente": "...",
    "licencia": "...",
    "titularNombre": "...",
    // ... mÃ¡s datos
  }
}
```

**Validaciones:**
- Solo para `tipo_transporte === 'Escolar'`
- Verifica que exista titular
- Verifica que exista vehÃ­culo
- Maneja datos opcionales (conductor)

### **3. BotÃ³n en el menÃº** (habilitaciones-table.tsx)
Agregado condicionalmente para transporte escolar:

```typescript
{hab.tipo_transporte === 'Escolar' && (
  <DropdownMenuItem onClick={() => handleDescargarCertificado(hab)}>
    <ClipboardCheck className="mr-2 h-4 w-4" />
    Certificado VerificaciÃ³n
  </DropdownMenuItem>
)}
```

**Proceso:**
1. Obtiene datos desde API (JSON)
2. Importa dinÃ¡micamente la funciÃ³n de generaciÃ³n
3. Genera PDF en el navegador
4. Descarga automÃ¡ticamente

---

## ğŸš€ CÃ³mo Usar

### **Desde la interfaz:**

1. Ir a lista de habilitaciones
2. Buscar una habilitaciÃ³n de **Transporte Escolar**
3. Click en menÃº (â‹®)
4. Click en "**Certificado VerificaciÃ³n**"
5. Se descarga el PDF automÃ¡ticamente

---

## ğŸ“Š Datos que Incluye

### **De la HabilitaciÃ³n:**
- NÃºmero de expediente
- NÃºmero de licencia
- Tipo de habilitaciÃ³n
- Tipo de transporte

### **Del Titular:**
- Nombre completo
- DNI
- Domicilio (calle + nro + localidad)

### **Del Conductor (opcional):**
- Nombre completo
- DNI

### **Del VehÃ­culo:**
- Dominio
- Marca
- Modelo
- InscripciÃ³n inicial

### **Ãtems de VerificaciÃ³n:**
- 13 items predefinidos
- Columnas para marcar: Bien/Regular/Mal
- Campo de observaciones por item

---

## ğŸ¨ DiseÃ±o Profesional - OPTIMIZADO

### **Colores:**
- **Header:** Bordo (#8B0000) con texto blanco
- **TÃ­tulos de secciÃ³n:** Bordo (#8B0000)
- **Labels:** Gris oscuro (#505050)
- **Datos:** Negro (#000000)
- **Tabla:** Bordes grises (#C8C8C8)
- **Firmas:** Gris (#646464)

### **TipografÃ­a Escalada:**
- Header tÃ­tulo: Helvetica Bold 14pt (â†“ de 16pt)
- Header subtÃ­tulo: Helvetica Normal 8pt (â†“ de 9pt)
- Fecha: Helvetica 7pt (â†“ de 8pt)
- Secciones: Helvetica Bold 9pt (â†“ de 10pt)
- Labels: Helvetica Normal 7pt (â†“ de 8pt)
- Datos: Helvetica Bold 8pt (â†“ de 9pt)
- Tabla headers: Helvetica Bold 7pt
- Tabla body: Helvetica 6.5pt (â†“ de 7pt)
- Firmas: Helvetica 7pt (â†“ de 8pt)

### **Layout Optimizado:**
- **MÃ¡rgenes:** 12mm (â†“ de 15mm) â†’ +6mm de espacio Ãºtil
- **Header:** 25mm de alto (â†“ de 30mm)
- **2 columnas** para datos principales
- **Secciones integradas:** VehÃ­culo y Conductor juntos
- **Tabla compacta:**
  - DescripciÃ³n: 95mm
  - B/R/M: 10mm c/u (â†“ de 15mm)
  - Observaciones: 61mm
  - Altura mÃ­nima celdas: 6mm
  - Padding: 0.8mm (â†“ de 1.5mm)
- **Firmas:** 65mm de ancho (â†“ de 70mm), compactas al pie

---

## ğŸ”§ PersonalizaciÃ³n Futura

### **Para agregar items de verificaciÃ³n:**

Editar en `lib/certificado-verificacion-escolar.ts`:

```typescript
const ITEMS_ESCOLAR = [
  // ... items existentes ...
  'Nuevo item a verificar',
]
```

### **Para modificar colores:**

```typescript
doc.setFillColor(139, 0, 0) // Cambiar RGB del bordo
```

### **Para integrar con BD de inspecciones:**

El sistema ya estÃ¡ preparado para recibir datos de inspecciones:

```typescript
interface DatosVerificacion {
  // ... campos existentes ...
  items?: Array<{
    descripcion: string
    estado: 'bien' | 'regular' | 'mal' | null
    observaciones?: string
  }>
}
```

Si se pasan `items` con datos, los checkmarks (âœ“) aparecerÃ¡n automÃ¡ticamente en las columnas correspondientes.

---

## âœ… Validaciones Implementadas

### **En el endpoint API:**

1. **Usuario autenticado** â†’ `getSession()`
2. **ID vÃ¡lido** â†’ `parseInt(params.id)`
3. **HabilitaciÃ³n existe** â†’ Prisma query
4. **Es transporte escolar** â†’ `tipo_transporte === 'Escolar'`
5. **Tiene titular** â†’ Required
6. **Tiene vehÃ­culo** â†’ Required
7. **Datos de persona no nulos** â†’ Type guards

---

## ğŸ“± IntegraciÃ³n con el Sistema

### **UbicaciÃ³n en el menÃº:**

```
MenÃº HabilitaciÃ³n (â‹®)
  ğŸ‘ï¸  Ver Detalle
  âœï¸  Editar
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ« Ver Credencial
  ğŸ“„ Ver ResoluciÃ³n
  ğŸ“¥ Descargar PDF
  ğŸ“‹ Certificado VerificaciÃ³n  â† NUEVO (solo escolar)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ”„ GestiÃ³n  â–º
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ¤– Consultar con IA
```

---

## ğŸ‰ Resultado Final - VERSIÃ“N OPTIMIZADA

Un certificado profesional de **ALTA CALIDAD** que:

âœ… **Garantizado en 1 pÃ¡gina** â†’ Layout ultra-compacto optimizado  
âœ… **Incluye todos los Ã­tems** â†’ 13 items de verificaciÃ³n  
âœ… **DiseÃ±o institucional** â†’ Color bordo profesional  
âœ… **Datos completos** â†’ Titular, conductor, vehÃ­culo  
âœ… **Listo para firmar** â†’ Espacios para 2 firmas  
âœ… **FÃ¡cil de generar** â†’ 1 click desde el menÃº  
âœ… **Solo para escolar** â†’ ValidaciÃ³n automÃ¡tica  
âœ… **Alta legibilidad** â†’ Fuentes escaladas pero claras  
âœ… **Archivo liviano** â†’ CompresiÃ³n activada  
âœ… **Espaciado inteligente** â†’ MÃ¡ximo contenido, mÃ­nimo desperdicio  

---

## ğŸ“Š ComparaciÃ³n de Optimizaciones:

| Elemento | Antes | Ahora | Ganancia |
|----------|-------|-------|----------|
| MÃ¡rgenes | 15mm | 12mm | +6mm Ãºtil |
| Header | 30mm | 25mm | +5mm Ãºtil |
| Fuente tÃ­tulos | 16pt | 14pt | MÃ¡s espacio |
| Fuente datos | 9pt | 8pt | MÃ¡s espacio |
| Fuente tabla | 7pt | 6.5pt | MÃ¡s espacio |
| Cols. B/R/M | 15mm | 10mm | +15mm Ãºtil |
| Padding tabla | 1.5mm | 0.8mm | MÃ¡s filas |
| Firmas | 70mm | 65mm | MÃ¡s compacto |
| **Total ganado** | - | - | **~30mm+ vertical** |

---

**Â¡Certificado de verificaciÃ³n profesional OPTIMIZADO listo para producciÃ³n!** ğŸ“‹âœ¨ğŸš€
