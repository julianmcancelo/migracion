# ğŸ“‹ Certificado de VerificaciÃ³n Vehicular - Transporte Escolar

## âœ… Implementado

He creado un sistema completo para generar **Certificados de VerificaciÃ³n Vehicular** especÃ­ficos para transporte escolar, con diseÃ±o profesional y todos los Ã­tems requeridos en una sola pÃ¡gina.

---

## ğŸ¨ DiseÃ±o del Certificado

### **Estructura Visual (1 PÃ¡gina A4):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚ â† Header Bordo
â”‚ CERTIFICADO DE VERIFICACIÃ“N VEHICULAR       â”‚
â”‚ Subsecretaria de Ordenamiento Urbano        â”‚
â”‚ DirecciÃ³n Gral. de Movilidad y Transporte   â”‚
â”‚                          Fecha: 26/10/2025  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Expediente NÂ°: XXX    Licencia NÂ°: XXX      â”‚
â”‚ Tipo: HABILITACIÃ“N    Transporte: Escolar   â”‚
â”‚                                             â”‚
â”‚ Titular                                      â”‚
â”‚ Nombre: JUAN GARCÃA                         â”‚
â”‚ DNI: 12345678                               â”‚
â”‚ Domicilio: Calle 123, LanÃºs                 â”‚
â”‚                                             â”‚
â”‚ Conductor                                    â”‚
â”‚ Nombre: MARÃA LÃ“PEZ                         â”‚
â”‚ DNI: 87654321                               â”‚
â”‚                                             â”‚
â”‚ VehÃ­culo                                     â”‚
â”‚ Dominio: ABC123                             â”‚
â”‚ Marca: Ford     Modelo: Transit             â”‚
â”‚ InscripciÃ³n Inicial: 01/01/2020             â”‚
â”‚                                             â”‚
â”‚ DETALLES Y OBSERVACIONES DEL VEHÃCULO       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚DescripciÃ³n â”‚B â”‚R  â”‚M  â”‚Observaciones   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚Pta. acc... â”‚âœ“ â”‚   â”‚   â”‚                â”‚ â”‚
â”‚ â”‚Pta. acc... â”‚âœ“ â”‚   â”‚   â”‚                â”‚ â”‚
â”‚ â”‚Salida Emer.â”‚  â”‚âœ“  â”‚   â”‚Revisar         â”‚ â”‚
â”‚ â”‚... (13 items en total)                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ __________________    __________________    â”‚
â”‚ Firma Interesado      Firma Verificador    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Items de VerificaciÃ³n (13 Obligatorios)

1. Pta. accionada cond. para desc./ asc. (Puerta derecha)
2. Pta. accionada cond. para desc./ asc. (Puerta izquierda)
3. Salida de Emer. indep. de laplataf. asc. / desc. (En Caso de Combi - L. Der. y Trasero)
4. Vent. Vidrio Temp. / inastillable (Apertura 10 cm)
5. Pisos rec. con mat. Antideslizantes
6. Dimens. de Banquetas ( desde el piso 0.40 mts - ancho min 0.45mts Prof. medida horiz. 0.40 mts)
7. Asientos: Fijos, Acolchados, Estructu. metalicas, revestimiento (Caucho o similar )
8. Puerta Izquierda de la Carroceria
9. Cinturones de Seguridad en todos los asientos
10. Cabezales o apoya Cabeza en todos los asientos
11. Espacios Libres
12. Pintura ( Carroceria baja y capot naranja NÂº 1054 IRAM - carroceria altatecho y parantes Color blanco)
13. Leyenda de Escolares o NiÃ±os TamaÃ±o minimo : 0,20 mts

---

## ğŸ¯ Archivos Creados

### **1. `components/habilitaciones/certificado-verificacion-pdf.tsx`**
Componente cliente para generar el PDF:

```typescript
export function generarCertificadoVerificacionPDF(datos: DatosVerificacion): jsPDF
```

**CaracterÃ­sticas:**
- Genera PDF en el **navegador** (no en el servidor)
- Header con fondo bordo (color institucional)
- InformaciÃ³n organizada en 2 columnas
- Tabla con 13 items predefinidos
- Columnas: DescripciÃ³n, Bien, Regular, Mal, Observaciones
- Espacios para firmas
- Todo en 1 pÃ¡gina A4

### **2. `app/api/habilitaciones/[id]/certificado-verificacion/route.ts`**
Endpoint API para obtener datos del certificado:

```typescript
GET /api/habilitaciones/[id]/certificado-verificacion
```

**Retorna:**
```json
{
  "success": true,
  "data": {
    "expediente": "...",
    "licencia": "...",
    "titularNombre": "...",
    // ... mÃ¡s datos
  }
}
```

**Validaciones:**
- Solo para `tipo_transporte === 'Escolar'`
- Verifica que exista titular
- Verifica que exista vehÃ­culo
- Maneja datos opcionales (conductor)

### **3. BotÃ³n en el menÃº** (habilitaciones-table.tsx)
Agregado condicionalmente para transporte escolar:

```typescript
{hab.tipo_transporte === 'Escolar' && (
  <DropdownMenuItem onClick={() => handleDescargarCertificado(hab)}>
    <ClipboardCheck className="mr-2 h-4 w-4" />
    Certificado VerificaciÃ³n
  </DropdownMenuItem>
)}
```

**Proceso:**
1. Obtiene datos desde API (JSON)
2. Importa dinÃ¡micamente la funciÃ³n de generaciÃ³n
3. Genera PDF en el navegador
4. Descarga automÃ¡ticamente

---

## ğŸš€ CÃ³mo Usar

### **Desde la interfaz:**

1. Ir a lista de habilitaciones
2. Buscar una habilitaciÃ³n de **Transporte Escolar**
3. Click en menÃº (â‹®)
4. Click en "**Certificado VerificaciÃ³n**"
5. Se descarga el PDF automÃ¡ticamente

---

## ğŸ“Š Datos que Incluye

### **De la HabilitaciÃ³n:**
- NÃºmero de expediente
- NÃºmero de licencia
- Tipo de habilitaciÃ³n
- Tipo de transporte

### **Del Titular:**
- Nombre completo
- DNI
- Domicilio (calle + nro + localidad)

### **Del Conductor (opcional):**
- Nombre completo
- DNI

### **Del VehÃ­culo:**
- Dominio
- Marca
- Modelo
- InscripciÃ³n inicial

### **Ãtems de VerificaciÃ³n:**
- 13 items predefinidos
- Columnas para marcar: Bien/Regular/Mal
- Campo de observaciones por item

---

## ğŸ¨ DiseÃ±o Profesional

### **Colores:**
- **Header:** Bordo (#8B0000) con texto blanco
- **TÃ­tulos de secciÃ³n:** Bordo
- **Tabla:** Bordes grises suaves
- **Texto:** Negro para datos, gris para labels

### **TipografÃ­a:**
- Header: Helvetica Bold 16pt
- SubtÃ­tulos: Helvetica Bold 10pt
- Datos: Helvetica Normal 9pt
- Tabla: Helvetica 7-8pt (optimizada para espacio)

### **Layout:**
- MÃ¡rgenes: 15mm
- 2 columnas para datos principales
- Tabla de ancho completo
- Firmas centradas al pie

---

## ğŸ”§ PersonalizaciÃ³n Futura

### **Para agregar items de verificaciÃ³n:**

Editar en `lib/certificado-verificacion-escolar.ts`:

```typescript
const ITEMS_ESCOLAR = [
  // ... items existentes ...
  'Nuevo item a verificar',
]
```

### **Para modificar colores:**

```typescript
doc.setFillColor(139, 0, 0) // Cambiar RGB del bordo
```

### **Para integrar con BD de inspecciones:**

El sistema ya estÃ¡ preparado para recibir datos de inspecciones:

```typescript
interface DatosVerificacion {
  // ... campos existentes ...
  items?: Array<{
    descripcion: string
    estado: 'bien' | 'regular' | 'mal' | null
    observaciones?: string
  }>
}
```

Si se pasan `items` con datos, los checkmarks (âœ“) aparecerÃ¡n automÃ¡ticamente en las columnas correspondientes.

---

## âœ… Validaciones Implementadas

### **En el endpoint API:**

1. **Usuario autenticado** â†’ `getSession()`
2. **ID vÃ¡lido** â†’ `parseInt(params.id)`
3. **HabilitaciÃ³n existe** â†’ Prisma query
4. **Es transporte escolar** â†’ `tipo_transporte === 'Escolar'`
5. **Tiene titular** â†’ Required
6. **Tiene vehÃ­culo** â†’ Required
7. **Datos de persona no nulos** â†’ Type guards

---

## ğŸ“± IntegraciÃ³n con el Sistema

### **UbicaciÃ³n en el menÃº:**

```
MenÃº HabilitaciÃ³n (â‹®)
  ğŸ‘ï¸  Ver Detalle
  âœï¸  Editar
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ« Ver Credencial
  ğŸ“„ Ver ResoluciÃ³n
  ğŸ“¥ Descargar PDF
  ğŸ“‹ Certificado VerificaciÃ³n  â† NUEVO (solo escolar)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ”„ GestiÃ³n  â–º
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ¤– Consultar con IA
```

---

## ğŸ‰ Resultado Final

Un certificado profesional que:

âœ… **Se ajusta a 1 pÃ¡gina** â†’ No desperdicia papel  
âœ… **Incluye todos los Ã­tems requeridos** â†’ 13 items  
âœ… **DiseÃ±o institucional** â†’ Color bordo, logo preparado  
âœ… **Datos completos** â†’ Titular, conductor, vehÃ­culo  
âœ… **Listo para firmar** â†’ Espacios para firmas  
âœ… **FÃ¡cil de generar** â†’ 1 click desde el menÃº  
âœ… **Solo para escolar** â†’ ValidaciÃ³n automÃ¡tica  

**Â¡Certificado de verificaciÃ³n profesional listo para usar!** ğŸ“‹âœ¨
